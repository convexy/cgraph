var y=Object.defineProperty;var p=(d,e,i)=>e in d?y(d,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):d[e]=i;var l=(d,e,i)=>p(d,typeof e!="symbol"?e+"":e,i);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))a(t);new MutationObserver(t=>{for(const s of t)if(s.type==="childList")for(const r of s.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&a(r)}).observe(document,{childList:!0,subtree:!0});function i(t){const s={};return t.integrity&&(s.integrity=t.integrity),t.referrerPolicy&&(s.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?s.credentials="include":t.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function a(t){if(t.ep)return;t.ep=!0;const s=i(t);fetch(t.href,s)}})();const c="12",m="Roboto",g="dimgray";class x{constructor(e,i,a,t){l(this,"minValue");l(this,"minCoord");l(this,"maxValue");l(this,"maxCoord");this.minValue=e,this.minCoord=i,this.maxValue=a,this.maxCoord=t}getCoord(e){return(e-this.minValue)*(this.maxCoord-this.minCoord)/(this.maxValue-this.minValue)+this.minCoord}getValue(e){return(e-this.minCoord)*(this.maxValue-this.minValue)/(this.maxCoord-this.minCoord)+this.minValue}}class w{constructor(e){l(this,"value");l(this,"last");let i=0,a=0,t=0;e instanceof Date?(i=e.getHours(),a=e.getMinutes(),t=e.getSeconds(),this.last=!1):(i=Math.floor(e/60/60),a=Math.floor((e-i*60*60)/60),t=Math.floor(e-i*60*60-a*60),this.last=e==86400),this.value=new Date(2e3,0,1,i,a,t)}set(e){let i=0,a=0,t=0;e instanceof Date?(i=e.getHours(),a=e.getMinutes(),t=e.getSeconds(),this.last=!1):(i=Math.floor(e/60/60),a=Math.floor((e-i*60*60)/60),t=Math.floor(e-i*60*60-a*60),this.last=e==86400),this.value=new Date(2e3,0,1,i,a,t)}getValue(){return this.last?86400:this.value.getHours()*60*60+this.value.getMinutes()*60+this.value.getSeconds()}getHours(){return this.value.getHours()}getMinutes(){return this.value.getMinutes()}getSeconds(){return this.value.getSeconds()}toString(){return this.value.getHours()+":"+this.value.getMinutes().toString().padStart(2,"0")+":"+this.value.getSeconds().toString().padStart(2,"0")}toHMString(){return this.value.getHours()+":"+this.value.getMinutes().toString().padStart(2,"0")}}class C{constructor(e,i,a,t,s){l(this,"title");l(this,"xAxisLabel");l(this,"yAxisLabel");l(this,"svg");l(this,"data");l(this,"colors");l(this,"legends");l(this,"xScale");l(this,"yScale");l(this,"year");l(this,"month");l(this,"dataPointAreas");if(!e||!(e instanceof SVGSVGElement))throw new Error("SVG element not found!");this.title=s==null?void 0:s.title,this.xAxisLabel=s==null?void 0:s.xAxisLabel,this.yAxisLabel=s==null?void 0:s.yAxisLabel,this.svg=e,this.data=[...i],this.colors=a,this.legends=t,this.xScale=new x(0,20+(this.yAxisLabel?20:0),86400,this.svg.width.baseVal.value-100),this.yScale=new x(1,20+(this.title?20:0)+(this.xAxisLabel?20:0),32,this.svg.height.baseVal.value-20),this.year=2e3,this.month=1,this.dataPointAreas=[]}setYM(e,i){this.year=e,this.month=i}clear(){for(;this.svg.firstChild;)this.svg.removeChild(this.svg.firstChild);this.dataPointAreas.length=0}updateScale(){this.xScale.maxCoord=this.svg.width.animVal.value-100,this.yScale.maxCoord=this.svg.height.animVal.value-20}drawYM(){const e=document.createElementNS("http://www.w3.org/2000/svg","text");e.setAttribute("x","50"),e.setAttribute("y",(10+(this.title?20:0)).toString()),e.setAttribute("font-family",m),e.setAttribute("font-size",c),e.setAttribute("fill","black"),e.setAttribute("text-anchor","middle"),e.setAttribute("dominant-baseline","middle"),e.textContent=this.year+"年"+this.month+"月",this.svg.appendChild(e);const i=document.createElementNS("http://www.w3.org/2000/svg","polygon");i.setAttribute("points",`15,${5+(this.title?20:0)} 5,${10+(this.title?20:0)} 15,${15+(this.title?20:0)} `),i.setAttribute("fill","black"),i.textContent=this.year+"年"+this.month+"月";const a=this.month>1?{year:this.year,month:this.month-1}:{year:this.year-1,month:12};this.data.some(r=>r.startDateTime.getFullYear()<a.year||r.startDateTime.getFullYear()==a.year&&r.startDateTime.getMonth()+1<=a.month)?(i.classList.add("cgraph-inactive"),i.addEventListener("mouseenter",()=>i.classList.remove("cgraph-inactive")),i.addEventListener("mouseleave",()=>i.classList.add("cgraph-inactive")),i.addEventListener("click",()=>{this.setYM(a.year,a.month),this.render()})):i.classList.add("cgraph-disable"),this.svg.appendChild(i);const t=document.createElementNS("http://www.w3.org/2000/svg","polygon");t.setAttribute("points",`85,${5+(this.title?20:0)} 95,${10+(this.title?20:0)} 85,${15+(this.title?20:0)} `),t.setAttribute("fill","black"),t.textContent=this.year+"年"+this.month+"月";const s=this.month<12?{year:this.year,month:this.month+1}:{year:this.year+1,month:1};this.data.some(r=>r.endDateTime.getFullYear()>s.year||r.endDateTime.getFullYear()==s.year&&r.endDateTime.getMonth()+1>=s.month)?(t.classList.add("cgraph-inactive"),t.addEventListener("mouseenter",()=>t.classList.remove("cgraph-inactive")),t.addEventListener("mouseleave",()=>t.classList.add("cgraph-inactive")),t.addEventListener("click",()=>{this.setYM(s.year,s.month),this.render()})):t.classList.add("cgraph-disable"),this.svg.appendChild(t)}drawAxes(){if(this.updateScale(),this.xAxisLabel){const t=document.createElementNS("http://www.w3.org/2000/svg","text");t.setAttribute("x",((this.xScale.maxCoord-this.xScale.minCoord)/2+this.xScale.minCoord).toString()),t.setAttribute("y",(10+(this.title?20:0)).toString()),t.setAttribute("font-family",m),t.setAttribute("font-size",c),t.setAttribute("fill","black"),t.setAttribute("text-anchor","middle"),t.setAttribute("dominant-baseline","middle"),t.textContent=this.xAxisLabel,this.svg.appendChild(t)}const e=document.createElementNS("http://www.w3.org/2000/svg","line");e.setAttribute("x1",this.xScale.minCoord.toString()),e.setAttribute("y1",(this.yScale.minCoord-.5).toString()),e.setAttribute("x2",this.xScale.maxCoord.toString()),e.setAttribute("y2",(this.yScale.minCoord-.5).toString()),e.setAttribute("stroke",g),e.setAttribute("stroke-width","1"),this.svg.appendChild(e);for(let t=0;t<=86400;t+=60*60){const s=new w(t);if(s.getHours()%2==0){if(t<86400){const n=document.createElementNS("http://www.w3.org/2000/svg","text");n.setAttribute("x",this.xScale.getCoord(s.getValue()).toString()),n.setAttribute("y",(this.yScale.minCoord-4).toString()),n.setAttribute("font-family",m),n.setAttribute("font-size",c),n.setAttribute("fill",g),n.textContent=s.toHMString(),this.svg.appendChild(n)}const r=document.createElementNS("http://www.w3.org/2000/svg","line");r.setAttribute("x1",this.xScale.getCoord(s.getValue()).toString()),r.setAttribute("y1",this.yScale.minCoord.toString()),r.setAttribute("x2",this.xScale.getCoord(s.getValue()).toString()),r.setAttribute("y2",(this.yScale.minCoord-4).toString()),r.setAttribute("stroke",g),r.setAttribute("stroke-width","1"),this.svg.appendChild(r)}else{const r=document.createElementNS("http://www.w3.org/2000/svg","line");r.setAttribute("x1",this.xScale.getCoord(s.getValue()).toString()),r.setAttribute("y1",this.yScale.minCoord.toString()),r.setAttribute("x2",this.xScale.getCoord(s.getValue()).toString()),r.setAttribute("y2",(this.yScale.minCoord-2).toString()),r.setAttribute("stroke",g),r.setAttribute("stroke-width","1"),this.svg.appendChild(r)}}if(this.yAxisLabel){const t=document.createElementNS("http://www.w3.org/2000/svg","text");t.setAttribute("x","10"),t.setAttribute("y",((this.yScale.maxCoord-this.yScale.minCoord)/2+this.yScale.minCoord).toString()),t.setAttribute("font-family",m),t.setAttribute("font-size",c),t.setAttribute("fill","black"),t.setAttribute("text-anchor","middle"),t.setAttribute("dominant-baseline","middle"),t.textContent=this.yAxisLabel,t.setAttribute("transform",`rotate(-90 10 ${(this.yScale.maxCoord-this.yScale.minCoord)/2+this.yScale.minCoord})`),this.svg.appendChild(t)}const i=document.createElementNS("http://www.w3.org/2000/svg","line");i.setAttribute("x1",(this.xScale.minCoord-.5).toString()),i.setAttribute("y1",this.yScale.minCoord.toString()),i.setAttribute("x2",(this.xScale.minCoord-.5).toString()),i.setAttribute("y2",this.yScale.maxCoord.toString()),i.setAttribute("stroke",g),i.setAttribute("stroke-width","1"),this.svg.appendChild(i);const a=this.getLastDay();for(let t=1;t<=31;t+=1){if(t<=a){const r=document.createElementNS("http://www.w3.org/2000/svg","text");r.setAttribute("x",(this.xScale.minCoord-4).toString()),r.setAttribute("y",((this.yScale.getCoord(t)+this.yScale.getCoord(t+1))/2).toString()),r.setAttribute("font-family",m),r.setAttribute("font-size",c),r.setAttribute("fill",g),r.setAttribute("text-anchor","end"),r.setAttribute("dominant-baseline","middle"),r.textContent=t.toString(),this.svg.appendChild(r)}const s=document.createElementNS("http://www.w3.org/2000/svg","line");s.setAttribute("x1",(this.xScale.minCoord-3).toString()),s.setAttribute("y1",this.yScale.getCoord(t).toString()),s.setAttribute("x2",this.xScale.minCoord.toString()),s.setAttribute("y2",this.yScale.getCoord(t).toString()),s.setAttribute("stroke",g),s.setAttribute("stroke-width","1"),this.svg.appendChild(s)}}plotData(){const e=this.data.filter(t=>t.startDateTime.getFullYear()==this.year&&t.startDateTime.getMonth()+1==this.month||t.endDateTime.getFullYear()==this.year&&t.endDateTime.getMonth()+1==this.month);e.sort((t,s)=>t.startDateTime.getTime()-s.startDateTime.getTime());const i=document.createElementNS("http://www.w3.org/2000/svg","g");i.classList.add("cgraph-plotarea");const a=[];for(const t of e){let s=1,r=new w(0),n=this.getLastDay(),b=new w(86400);new Date(this.year,this.month-1,1).getTime()<=t.startDateTime.getTime()&&(s=t.startDateTime.getDate(),r.set(t.startDateTime)),t.endDateTime.getTime()<=new Date(this.year,this.month,1).getTime()&&(n=t.endDateTime.getDate(),b.set(t.endDateTime));const h=document.createElementNS("http://www.w3.org/2000/svg","g");h.setAttribute("fill",this.colors[t.flag]),h.classList.add("cgraph-tm-datapoint"),h.addEventListener("mouseenter",function(){h.classList.add("cgraph-active"),a.forEach(o=>{o!=h&&o.classList.add("cgraph-inactive")})}),h.addEventListener("mouseleave",function(){h.classList.remove("cgraph-active"),a.forEach(o=>{o!=h&&o.classList.remove("cgraph-inactive")})});const u=document.createElementNS("http://www.w3.org/2000/svg","title");u.textContent="開始: "+t.startDateTime.toLocaleString()+`
終了: `+t.endDateTime.toLocaleString()+`
時間: `+((t.endDateTime.getTime()-t.startDateTime.getTime())/1e3/60).toFixed(1)+`分
フラグ: `+this.legends[t.flag],h.appendChild(u);for(let o=s;o<=n;o++){let A=o==s?r:new w(0),f=o==n?b:new w(86400);const S=document.createElementNS("http://www.w3.org/2000/svg","rect");S.setAttribute("x",this.xScale.getCoord(A.getValue()).toString()),S.setAttribute("y",this.yScale.getCoord(o).toString()),S.setAttribute("width",(this.xScale.getCoord(f.getValue())-this.xScale.getCoord(A.getValue())>1?this.xScale.getCoord(f.getValue())-this.xScale.getCoord(A.getValue())-1:1).toString()),S.setAttribute("height",(this.yScale.getCoord(o+1)-this.yScale.getCoord(o)-1).toString()),h.appendChild(S),a.push(h)}i.appendChild(h)}this.dataPointAreas.push(...a),this.svg.appendChild(i)}drawTitle(){if(this.title){const e=document.createElementNS("http://www.w3.org/2000/svg","text");e.setAttribute("x","10"),e.setAttribute("y","10"),e.setAttribute("font-family",m),e.setAttribute("font-size",c),e.setAttribute("font-weight","bold"),e.setAttribute("fill","black"),e.setAttribute("dominant-baseline","middle"),e.textContent=this.title,this.svg.appendChild(e)}}drawLegends(){const e=document.createElementNS("http://www.w3.org/2000/svg","rect");e.setAttribute("x",(this.svg.width.animVal.value-90).toString()),e.setAttribute("y","20"),e.setAttribute("width","80"),e.setAttribute("height",(20*(this.legends.length+1)).toString()),e.setAttribute("fill","white"),e.setAttribute("stroke","white"),this.svg.appendChild(e);const i=document.createElementNS("http://www.w3.org/2000/svg","text");i.setAttribute("x",(this.svg.width.animVal.value-80).toString()),i.setAttribute("y","30"),i.setAttribute("font-family",m),i.setAttribute("font-size",c),i.setAttribute("font-weight","bold"),i.setAttribute("fill",g),i.setAttribute("dominant-baseline","middle"),i.textContent="凡例",this.svg.appendChild(i);for(let a=0;a<this.legends.length;a++){const t=document.createElementNS("http://www.w3.org/2000/svg","rect");t.setAttribute("x",(this.svg.width.animVal.value-80).toString()),t.setAttribute("y",(10+(a+2)*20-10).toString()),t.setAttribute("width","20"),t.setAttribute("height","18"),t.setAttribute("fill",this.colors[a]),this.svg.appendChild(t);const s=document.createElementNS("http://www.w3.org/2000/svg","text");s.setAttribute("x",(this.svg.width.animVal.value-50).toString()),s.setAttribute("y",(10+(a+2)*20).toString()),s.setAttribute("font-family",m),s.setAttribute("font-size",c),s.setAttribute("fill",g),s.setAttribute("dominant-baseline","middle"),s.textContent=this.legends[a],this.svg.appendChild(s)}}render(){this.clear(),this.drawTitle(),this.drawYM(),this.drawAxes(),this.plotData(),this.drawLegends()}getLastDay(){const e=new Date(this.year,this.month,1);return e.setDate(e.getDate()-1),e.getDate()}addData(e){this.data.push(...e.filter(i=>this.data.every(a=>a.startDateTime.getTime()!=i.startDateTime.getTime()||a.endDateTime.getTime()!=i.endDateTime.getTime()||a.flag!=i.flag))),this.render()}}window.addEventListener("DOMContentLoaded",function(){const d=document.getElementById("maincanvas"),e=["#00ff00","#00ffff","#ffff00"],i=["a","b","c"],a=[],t=new Date(2025,2,1,0,0,0),s=new Date(2025,4,1,0,0,0);let r=t,n=0;for(;r.getTime()<s.getTime();){const o=(60+Math.floor(Math.random()*259140))*1e3;a.push({startDateTime:r,endDateTime:new Date(r.getTime()+o),flag:n}),r=new Date(r.getTime()+o),n++,n>=3&&(n=0)}const b=[],h=new Date(2025,12,1,0,0,0);for(;r.getTime()<h.getTime();){const o=(60+Math.floor(Math.random()*19940))*1e3;b.push({startDateTime:r,endDateTime:new Date(r.getTime()+o),flag:n}),r=new Date(r.getTime()+o),n++,n>=3&&(n=0)}const u=new C(d,a,e,i,{title:"稼働マップ",xAxisLabel:"時刻",yAxisLabel:"日付"});u.setYM(2025,4),u.render(),setTimeout(()=>{u.addData(b)},1e4)});
